<!doctype html>
<html lang="fr">
    <head>
        <title>..:: DemoJS 2012 ::..</title>
        <script type="text/javascript" src="lib/codef_r79/codef/codef_core.js"></script>
        <script type="text/javascript" src="lib/codef_r79/codef/codef_scrolltext.js"></script>
        <script type="text/javascript" src="lib/codef_r79/codef/codef_fx.js"></script> 
        <script type="text/javascript" src="lib/codef_r79/codef/codef_stats.js"></script> 
        <script type="text/javascript">
            //music
            var music;
            // offscreen canvas
            var offscreen_screen1;
            // txt screen 1
            var zuul_txt_screen1;
            // scrolltext identifier screen 1
            var zuul_scrolltext_screen1;
	    // logo
	    var zuul_logo_canvas;
            var zuul_logo_fx;
            // color line;
            var rastx = 0;
            var rasters;
            var sinfx;
            var myfxbg=[
                        {value: 0, amp: 8, inc:0.03, offset: -0.05},
                        {value: 0, amp: 4, inc:0.06, offset:  0.08}
                       ];


            //canvas : main screen
            var screen;
            // top logo
            // fonts image identifier screen 1
            var zuul_fonts_screen1;
            // moiray image
            var moiray;
            // frame counter
            var count = 0;
	    //timestamp
            var temps;


	    function byebye() {
		if (music) {
			music.pause();
		}
		window.location.href = '../index.html?team=zuul';
            }

	    function cassosKey() {
		if (window.addEventListener) {
			window.addEventListener("keydown", function(key) {
				if (key.keyCode === 32 || key.keyCode === 27) {
					byebye();
				}
			}, false);
		}
	    }

            function isUndefined(v) {
                return v === undefined;
            }

            function createCanvas(w, h, id_name) {
                if (isUndefined(id_name)) {
                    return new canvas(w, h);
                }
                return new canvas(w, h, id_name);
            }

            function initOffscreenScreen() {
		//play music
		music = document.getElementById('music');
		music.play();
                // initialize offscreen canvas
                offscreen_screen1 = createCanvas(640, 480);
                sinfx = new FX(offscreen_screen1, screen, myfxbg);
                rasters = new image('effects/rasters.png');
                zuul_fonts_screen1 = new image("fonts/006.png");
                zuul_fonts_screen1.initTile(32,32,32);
                zuul_scrolltext_screen1 = new scrolltext_horizontal();
                zuul_scrolltext_screen1.scrtxt = "                      ZUUL AND !!M ARE PROUD TO PRESENT THIS LIL' PRODUCTION ... GREETS GOES TO: EL MATADORS, WAGANONO, PAPYTRAP, KR8VITY, TBX (TWITTER), MSUICHE (TWITTER), NICOLASBRULEZ (TWITTER), AND ALL DEMOJS SCENERS...                                ";
                zuul_scrolltext_screen1.init(offscreen_screen1, zuul_fonts_screen1, 3);

                // top logo
                zuul_fonts_screen1 = new image("fonts/map3.png");
                zuul_fonts_screen1.initTile(80,62,32);
		zuul_logo_canvas = createCanvas(640,80);
		zuul_logo_fx = new FX(zuul_logo_canvas, screen, myfxbg);
            }

            function init() {
		temps = Date.now();
                //addstats();
		cassosKey();
                screen = createCanvas(640,480, "djs2012");
                moiray = new image('effects/anneaux.png');
                moiray.setmidhandle(true);
                initOffscreenScreen();
                render();
            }

            function renderOffscreenScreen() {
                offscreen_screen1.clear();

                // Bar ****************************************
                // Bottom
                offscreen_screen1.line(0, 480-32, 640, 480-32, 64, '#000000');
                if((rastx-=4) < -1008) rastx = 0;
                zuul_scrolltext_screen1.draw(480-32-16);
                rasters.draw(offscreen_screen1, rastx, 480-64);
                // /4 *******************

                // Top
                offscreen_screen1.line(0, 48, 640, 48, 96, '#000000');
                rasters.draw(offscreen_screen1, rastx, 96);
                // /Bar *********************************************
                sinfx.siny(0,0);
            }

            function render(time) {
		//console.log(time);

                updatestats();

                count+=2;
                screen.fill('#000000');
              
		//console.log(time - temps);
		if (time - temps > 60 * 1.5 * 1000) {
			byebye();
			return;
		}

                var x = Math.sin((count*1.5) * 3.14/180)*16;
                var y = Math.sin(count * 3.14/180)*16;
                var xx = Math.cos(count * 3.14/180)*16;
                var yy = Math.cos((count*1.5) * 3.14/180)*16;

                var s = 2.5 + (Math.cos((count*1.5) * 3.14/180) * 0.35);
	        	
		
                //moiray.draw(screen, 320-172+x, 240-172+y, 1, 0, s, 2.5);
                //moiray.draw(screen, 310-172+xx, 240-172+yy, 1, 0, 2.5, s);
		
		//moiray.draw(screen, 320-370+x, 240-410+y, 1, 0, s, 2.5);
                //moiray.draw(screen, 310-370+xx, 240-410+yy, 1, 0, 2.5, s);
		moiray.draw(screen, 320-370+x, 240-410+y, 1, 0, s, 2.5);
                moiray.draw(screen, 310-370+xx, 240-410+yy, 1, 0, 2.5, s);

                //console.log("x = " + x + "y = " +y);
                //console.log("xx = " + xx + "yy = " + yy);

                screen.line(0, 480-16, 640, 480-16, 32, '#000000');
                screen.line(0, 0, 640, 0, 32, '#000000');
                renderOffscreenScreen();

                // top logo
                //screen.line(200, 48, 440, 48, 64, '#FF0000');
		zuul_logo_canvas.clear();
                zuul_logo_canvas.fill('#000000');
                zuul_fonts_screen1.print(zuul_logo_canvas, "ZUUL", (640 - (80 * 4)) / 2, 15 , 1, 0, undefined, 62);
		zuul_logo_fx.sinx(0,0);
		
                requestAnimFrame(render);
            }

        </script>
    </head>

    <body onload="init()" style="background-color:#000000; margin-top:50px" >
        <div id="djs2012" style="border: 1px solid white; width:640px; heigth:480px; margin-left:auto; margin-right:auto">
		<audio id="music" preload="auto" loop="loop">
			<source src="music/jimpower1.mp3" type="audio/mpeg" />
			<source src="music/jimpower1.ogg" type="audio/ogg" />
		</audio>
    </body>
</html>
